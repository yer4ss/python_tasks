import sqlite3
import os

# conn = sqlite3.connect('cities.db')
# cursor = conn.cursor()
# cursor.execute('DROP TABLE IF EXISTS cities')

DB_NAME = "cities.db"


# Подключение к базе
def connect_db():
   return sqlite3.connect(DB_NAME)

# Создание таблицы
def create_table():
   with connect_db() as conn:
      conn.execute('''
            CREATE TABLE IF NOT EXISTS cities (
               id INTEGER PRIMARY KEY AUTOINCREMENT,
               name TEXT UNIQUE,
               description TEXT,
               image_url TEXT,
               trip_code TEXT,
               trip_name TEXT
            )
      ''')

# Добавление или обновление города
def add_city(name, description, image_url, trip_code=None, trip_name=None):

   # if trip_code and trip_name:  # URL
   #    trip_url = f"https://www.tripadvisor.ru/Tourism-{trip_code}-{trip_name}-Vacations.html"
   # else:
   #    trip_url = None  # Если не указаны код и название
   
   with connect_db() as conn:
      conn.execute('''
            INSERT INTO cities (name, description, image_url, trip_code, trip_name) 
            VALUES (?, ?, ?, ?, ?) 
            ON CONFLICT(name) 
            DO UPDATE SET 
               description = excluded.description,
               image_url = excluded.image_url,
               trip_code = excluded.trip_code,
               trip_name = excluded.trip_name
      ''', (name, description, image_url, trip_code, trip_name))

# Получение всех городов
def get_all_cities():
   with connect_db() as conn:
      return conn.execute('SELECT * FROM cities').fetchall()

# Экспорт данных в CSV (без writer)
def export_to_csv():
   cities = get_all_cities()
   with open("cities_export.csv", "w", encoding="utf-8") as file:
      file.write("ID,Название,Описание,Ссылка на изображение,Код,Название в URL\n")  # Заголовок
      for city in cities:
         file.write(",".join(str(field) if field is not None else "" for field in city) + "\n")  # Данные
   print("✅ Данные экспортированы в cities_export.csv!")

# # Создание таблицы
# create_table()

# # Добавление тестовых данных
# add_city("Астана", "Столица Казахстана, известная своей современной архитектурой. Город знаменит своими футуристическими зданиями, такими как Байтерек, Хан Шатыр и Дворец мира и согласия. В Астане проходят важные экономические и культурные форумы мирового уровня. Зимой город превращается в снежную сказку, а летом привлекает гостей своими зелёными парками.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Астана.jpg", "g293944", "Astana_Akmola_Province")
# add_city("Алматы", "Крупнейший город Казахстана, окружённый живописными горами Заилийского Алатау. Известен как культурный и финансовый центр страны. Здесь расположены знаменитый высокогорный каток Медео, горнолыжный курорт Шымбулак и смотровая площадка Кок-Тобе. Алматы славится своими зелёными улицами, уютными кафе и богатой историей.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Алматы.jpg", "g298251", "Almaty")
# add_city("Шымкент", "Третий по величине город Казахстана, известный своими восточными базарами, гостеприимством и богатой историей. Основанный более 2 200 лет назад, он является одним из древнейших городов региона. Здесь можно посетить этнографический комплекс «Кен-Баба», медресе XIX века и Археологический музей.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Шымкент.jpg", "g665317", "Shymkent_Turkistan_Region")
# add_city("Кокшетау", "Живописный город, окружённый озёрами и лесами. Кокшетау славится своими курортными зонами, такими как Бурабай и Зеренда, привлекающими туристов круглый год. Бурабай часто называют \"Казахстанской Швейцарией\" из-за его горных пейзажей и чистых озёр.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Кокшетау.jpg", "g665315", "Kokshetau_Akmola_Province")
# add_city("Костанай", "Город с богатым культурным наследием, расположенный на севере Казахстана. Здесь можно найти исторические памятники, музеи и театры. В регионе развита сельскохозяйственная и промышленная отрасль. В Костанае также проходит ежегодный фестиваль «Тобол-фест», посвящённый народным традициям.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Костанай.jpg", "g665314", "Kostanay_Kostanay_Province")
# add_city("Петропавловск", "Один из старейших городов Казахстана, основанный в XVIII веке. Здесь сохранилось множество архитектурных памятников, включая Петропавловскую крепость. Город известен своими уютными набережными, а также музеем литературы и искусства, посвящённым творчеству казахских писателей.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Петропавловск.jpg", "g844459", "Petropavlovsk_North_Kazakhstan_Province")
# add_city("Тараз", "Один из древнейших городов Центральной Азии с историей более 2 000 лет. Тараз славится древними мавзолеями Карахана и Айша-биби, которые являются важными культурными памятниками. Город также называют 'колыбелью казахской цивилизации' за его археологическое и историческое значение.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Тараз.jpg", "g1638447", "Taraz_Jambyl_Province")
# add_city("Кызылорда", "Город на реке Сырдарья, исторический центр Казахстана. Здесь в XIX веке располагалась первая столица Казахской АССР. Кызылорда также известна как центр казахской национальной письменности и образования, а поблизости находится знаменитый космодром Байконур.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Кызылорда.jpg", "g2350748", "Kyzylorda_Kyzylorda_Province")
# add_city("Туркестан", "Один из самых древних и священных городов Казахстана. Здесь находится мавзолей Ходжи Ахмеда Ясави – объект Всемирного наследия ЮНЕСКО. Туркестан является духовным и культурным центром страны, ежегодно привлекающим тысячи паломников и туристов.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Туркестан.jpg", "g424931", "Turkistan_Turkistan_Region")
# add_city("Атырау", "Нефтяная столица Казахстана, расположенная на реке Урал. Город разделён на две части, европейскую и азиатскую. Атырау известен своими рыбными промыслами, нефтяными месторождениями и современными небоскрёбами.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Атырау.jpg", "g616030", "Atyrau_Atyrau_Province")
# add_city("Уральск", "Исторический город на западе Казахстана, основанный в XVI веке. Уральск славится своей старинной архитектурой, особенно Казанским собором и домом Пугачёва. Здесь можно посетить музеи, посвящённые истории казачества и древнего Золотого Орды.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Уральск.jpg", "g1454025", "Oral_West_Kazakhstan_Province")
# add_city("Актау", "Город у Каспийского моря с красивыми пляжами и скалистыми пейзажами. Является важным портовым и туристическим центром. Вблизи города можно посетить урочище Босжира и подземную мечеть Бекет-Ата, считающуюся святыней.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Актау.jpg", "g674570", "Aktau_Mangystau_Province")
# add_city("Актобе", "Динамично развивающийся город на западе Казахстана. Здесь расположены крупные металлургические заводы и современные торговые центры. В окрестностях города можно посетить уникальные геологические образования – меловые горы Актау.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Актобе.jpg", "g608511", "Aktobe_Aktobe_Province")
# add_city("Усть-Каменогорск", "Город металлургов, расположенный среди гор Восточного Казахстана. Он известен своими красивыми природными пейзажами, такими как Бухтарминское водохранилище и национальный парк Катон-Карагай.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Усть-Каменогорск.jpg", "g737145", "Oskemen_East_Kazakhstan_Province")
# add_city("Павлодар", "Город с развитой промышленностью и живописными набережными. Павлодар известен своими современными театрами, музеями и близостью к национальному парку Баянаул.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Павлодар.jpg", "g788074", "Pavlodar_Pavlodar_Province")
# add_city("Караганда", "Крупный промышленный центр Казахстана, связанный с угольной промышленностью. Город славится своим театром имени Станиславского и парком Ботанический сад. Недалеко находится музей ГУЛАГа в поселке Долинка.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Караганда.jpg", "g608513", "Karaganda_Karagandy_Province")
# add_city("Темиртау", "Город металлургов, важный центр чёрной металлургии Казахстана. Здесь находится крупнейший металлургический завод страны. Также город известен своим ледовым дворцом и живописной набережной реки Нура.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Темиртау.jpg", "g5496331", "Temirtau_Karagandy_Province")
# add_city("Талдыкорган", "Административный центр Жетысуской области. Город славится своим живописным расположением у подножия гор Жетысуского Алатау. Здесь находится монумент Бабаларға тағзым, посвящённый предкам, а также парк Первого Президента и современный культурный центр.", 
#          "A:/yer4ss/Work/im python/bot gid/images/Талдыкорган.jpg", "g665316", "Taldykorgan_Almaty_Region")


print("✅")